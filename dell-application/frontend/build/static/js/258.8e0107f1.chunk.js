"use strict";(self.webpackChunkTUSKER_AI=self.webpackChunkTUSKER_AI||[]).push([[258],{70685:function(e,t,a){a.r(t),a.d(t,{default:function(){return ze}});var s=a(27565),r=a(27247),n=a.n(r),l=a(62195),i=a(91212),o=a(10467),d=a(60436),c=a(24765),u=a(5544),h=a(23029),p=a(92901),m=a(39874),g=a(85501),b=a(89379),f=a(85670),x=a(43368),v=a(43519),y=a(74177),D=a(27967),w=a(19505),A=a(22945),_=a(74702),j=a(21096),L=a(65971),S=a.n(L),C=a(63630),N=a(59635),F=a(3934),T=a(35540),M=a(35944),k=a.n(M),Y=a(65044),I=a(10782),P=a(7274),V=a(50521),O=a.n(V),z=a(83832),G=a(71744),E=a(68854),B=a(60409),R=a(27929);function U(e){var t=e.loading,a=e.size,s=e.title,r=e.submit,n=e.flag,l=e.color,i=e.className,o=e.dataTestId,d=e.icon,c=e.handleKeyDown,u=e.style,h=e.id;return(0,R.jsxs)(B.A,{id:h,style:u,onClick:r,size:a||"large",onKeyDown:c,disabled:n||!1,className:i||"ms-2",color:l||"primary","data-testid":o||"",children:[d&&(0,R.jsxs)("span",{children:[d,"\xa0"]}),s,t||""]})}var Z=function(e){var t=e.show,a=e.title,s=e.content,r=e.backdrop,n=e.keyboard,l=e.scrollable,i=e.size,o=e.arialabelledby,d=e.closeButtonFlag,c=e.id,u=e.handleClose,h=e.submitEmployee,p=e.flag,m=e.dialogClassName,g=e.fullscreen,b=e.applyButton,f=e.footerCustom,x=e.style,v=e.footerContent,y=e.animation,D=e.hideFooter;return(0,R.jsxs)(E.A,{show:t,onHide:u,backdrop:r,keyboard:n,scrollable:l||!0,size:i,dialogClassName:m,fullscreen:g||!1,"aria-labelledby":o,centered:!0,style:x,animation:y,children:[(0,R.jsx)(E.A.Header,{closeButton:d||!1,children:(0,R.jsx)(E.A.Title,{id:"example-modal-sizes-title-lg",children:a})}),(0,R.jsx)(E.A.Body,{children:s}),!D&&(0,R.jsx)(E.A.Footer,{style:{display:f&&"block"},children:f?v:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(U,{size:"md",color:"secondary",title:"Cancel",flag:!1,submit:u}),b&&(0,R.jsx)(U,{size:"md",color:"primary",title:c?"Update":"Save",flag:p,submit:h})]})})]})},W=a(65265),q=function(e){function t(e){var a;return(0,h.A)(this,t),(a=(0,m.A)(this,t,[e])).getTotalCamerasByLocationIds=function(){var e,t=a.props.user;(0,A.if)(["-1"],null===t||void 0===t||null===(e=t.roles[0])||void 0===e?void 0:e.role).then(function(e){if(e&&e.isSuccess){var t=e.data.map(function(e){return{label:e.camera_name,value:e.id}});t.push({label:"All Camera",value:"-1"}),a.setState({cameraData:t},function(){a.getColumnsAndData()})}else a.setState({blocking:!1}),console.log("Something went wrong")}).catch(function(e){e.detail&&console.log(e.detail)})},a.initializeColumns=function(){var e=[];e="Label"===a.props.dashboardGraphName?[{dataField:"camera_name",text:"Camera"},{dataField:"count",text:"Count"},{dataField:"date",text:"Date"},{dataField:"labels",text:"Labels",formatter:function(e){return e?e.split(",").map(function(e){return(0,P.G)(e.trim())}).join(", "):""}}]:[{dataField:"event_name",text:"Event"},{dataField:"event_type",text:"Event Type"},{dataField:"event_desc",text:"Event Description"},{dataField:"camera_name",text:"Camera Name"},{dataField:"event_date",text:"Event Date"}],a.setState({columns:e})},a.getColumnsAndData=function(){var e,t,s,r=a.state,n=r.currentFrameIndex,l=r.tableData,i=r.cameraData,o=r.activeTab,d=r.currentVideoIndex;if(l.length){var c="images"===o?l[n]:l[d],u=[],h=i.find(function(e){var t;return e.value.toString()===(null===c||void 0===c||null===(t=c.camera_id)||void 0===t?void 0:t.toString())}),p=h?h.label:"Unknown Camera",m=(null===c||void 0===c||null===(e=c.result)||void 0===e||null===(t=e.detection)||void 0===t?void 0:t.length)||0,g=M.utc(null===c||void 0===c||null===(s=c.frame_date)||void 0===s?void 0:s.$date).local().format("MMMM DD YYYY, h:mm:ss a"),b=Object.keys((null===c||void 0===c?void 0:c.counts)||{}).toString();u.push({camera_name:p,count:m,date:g,labels:b}),a.setState({data:u})}},a.handleNextFrame=function(){a.setState(function(e){return{currentFrameIndex:Math.min(e.currentFrameIndex+1,e.tableData.length-1),imageLoaded:!1}},a.getColumnsAndData)},a.handlePrevFrame=function(){a.setState(function(e){return{currentFrameIndex:Math.max(e.currentFrameIndex-1,0),imageLoaded:!1}},a.getColumnsAndData)},a.handleNextVideo=function(){a.setState(function(e){return{currentVideoIndex:Math.min(e.currentVideoIndex+1,e.tableData.length-1),imageLoaded:!1}},a.getColumnsAndData)},a.handlePrevVideo=function(){a.setState(function(e){return{currentVideoIndex:Math.max(e.currentVideoIndex-1,0),imageLoaded:!1}},a.getColumnsAndData)},a.handleCloseModal=function(){a.setState({showBoundingBox:!1,showBarTable:!1},function(){setTimeout(function(){a.props.clearPopupDataAction(),a.setState({showBoundingBox:!0})},300)})},a.handleZoomIn=function(e){return function(){return e()}},a.handleZoomOut=function(e){return function(){return e()}},a.handleResetTransform=function(e){return function(){return e()}},a.handleTabSelect=function(e){a.setState({activeTab:e})},a.state={tableData:e.tableData||[],showBarTable:e.showBarTable,dashboardGraphName:e.dashboardGraphName,columns:null,data:[],viewImageModal:!1,cameraData:[],currentFrameIndex:0,currentVideoIndex:0,imageLoaded:!1,activeTab:"images"},a}return(0,g.A)(t,e),(0,p.A)(t,[{key:"componentDidMount",value:function(){this.getTotalCamerasByLocationIds(),this.initializeColumns()}},{key:"componentDidUpdate",value:function(e,t){(t.currentFrameIndex!==this.state.currentFrameIndex||t.currentVideoIndex!==this.state.currentVideoIndex)&&this.setState({imageLoaded:!1})}},{key:"render",value:function(){var e,t,a,s=this,r=this.state,n=r.columns,l=r.data,i=r.currentFrameIndex,o=r.tableData,d=r.currentVideoIndex;r.imageLoaded,null===(e=o[i])||void 0===e||e.image_url,null===(t=o[d])||void 0===t||t.video_url;return(0,R.jsx)(Z,{size:"lg",show:this.state.showBarTable,handleClose:this.handleCloseModal,arialabelledby:"example-modal-sizes-title-lg",title:"My Result Details a",scrollable:!1,closeButtonFlag:!0,applyButton:!1,content:(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)(R.Fragment,{children:[l.length>0?(0,R.jsx)(N.A,{bootstrap4:!0,keyField:"id",data:l,columns:n,bordered:!1,wrapperClasses:"table-responsive"}):(0,R.jsx)("p",{children:"No data available"}),"Label"===this.props.dashboardGraphName?(0,R.jsx)(z.GT,{defaultScale:1,defaultPositionX:200,defaultPositionY:100,children:function(e){var t,a,r,n=e.zoomIn,l=e.zoomOut,d=e.resetTransform;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"tools",style:{width:"100%",marginBottom:"4px"},children:(0,R.jsx)(G.A,{zoomIn:n,zoomOut:l,className:"d-flex align-items-center justify-content-between",isFrame:!0,frameData:!0,resetTransform:d,onPrev:s.handlePrevFrame,onNext:s.handleNextFrame,isFirstFrame:0===i,isLastFrame:i===o.length-1})}),console.log("tableData[currentFrameIndex]11",o[i]),(0,R.jsx)("div",{className:"boundimage-full w-100",style:{margin:"0 auto"},children:(0,R.jsx)(z.WZ,{children:(0,R.jsx)(O(),{className:"row m-auto col-12 p-0 text-center",image:null===(t=o[i])||void 0===t?void 0:t.image_url,boxes:null===(a=o[i])||void 0===a||null===(r=a.result)||void 0===r?void 0:r.detection.map(function(e){return{coord:[e.location[0],e.location[1],e.location[2]-e.location[0],e.location[3]-e.location[1]],label:e.label}}),showLabels:!1,options:{colors:{normal:"red",selected:"red",unselected:"red"},style:{maxWidth:"100%",maxHeight:"90vh",margin:"auto",width:752,color:"red",height:470}}},i)})})]})}}):(0,R.jsx)(R.Fragment,{children:null!==(a=o[i])&&void 0!==a&&a.image_list?(0,R.jsxs)(F.A,{children:[(0,R.jsx)(T.A,{xl:6,md:6,sm:12,lg:6,children:(0,R.jsx)(z.GT,{defaultScale:1,defaultPositionX:200,defaultPositionY:100,children:function(e){var t,a,s,r,n,l=e.zoomIn,d=e.zoomOut,c=e.resetTransform;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"tools",style:{width:"100%",marginBottom:"4px"},children:(0,R.jsx)(G.A,{zoomIn:l,zoomOut:d,resetTransform:c,frameData:!0})}),console.log("tableData[currentFrameIndex]",o[i]),(0,R.jsx)("div",{className:"boundimage-full w-100",style:{margin:"0 auto"},children:(0,R.jsx)(z.WZ,{children:(0,R.jsx)("div",{className:"mt-5 mb-5",children:(0,R.jsx)(W.A,{style:{cursor:"pointer"},alt:"Image Here 1",children:(0,R.jsx)(O(),{className:"row m-auto col-12 p-0 text-center",image:(null===(t=o[i])||void 0===t||null===(a=t.image_list[0])||void 0===a?void 0:a.imageUrl)||(null===(s=o[i])||void 0===s?void 0:s.image_list[0]),boxes:null===(r=o[i])||void 0===r||null===(n=r.result)||void 0===n?void 0:n.detection.map(function(e){return{coord:[e.location[0],e.location[1],e.location[2]-e.location[0],e.location[3]-e.location[1]],label:e.label}}),options:{colors:{normal:"red",selected:"red",unselected:"red"},style:{maxWidth:"100%",maxHeight:"100vh",margin:"auto",width:"100vw",color:"red",height:510}}})})})})})]})}})}),(0,R.jsx)(T.A,{xl:6,md:6,sm:12,lg:6,children:(0,R.jsx)(z.GT,{defaultScale:1,defaultPositionX:200,defaultPositionY:100,children:function(e){var t,a,s,r,n,l=e.zoomIn,d=e.zoomOut,c=e.resetTransform;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"tools",style:{width:"100%",marginBottom:"4px"},children:(0,R.jsx)(G.A,{zoomIn:l,zoomOut:d,resetTransform:c,frameData:!0})}),(0,R.jsx)("div",{className:"boundimage-full w-100",style:{margin:"0 auto"},children:(0,R.jsx)(z.WZ,{children:(0,R.jsx)("div",{className:"mt-5 mb-5",children:(0,R.jsx)(W.A,{style:{cursor:"pointer"},alt:"Image Here 2",children:(0,R.jsx)(O(),{className:"row m-auto col-12 p-0 text-center",image:(null===(t=o[i])||void 0===t||null===(a=t.image_list[(null===(s=o[i])||void 0===s?void 0:s.image_list.length)-1])||void 0===a?void 0:a.imageUrl)||(null===(r=o[i])||void 0===r?void 0:r.image_list[(null===(n=o[i])||void 0===n?void 0:n.image_list.length)-1]),options:{colors:{normal:"red",selected:"red",unselected:"red"},style:{maxWidth:"100%",maxHeight:"100vh",margin:"auto",width:"100vw",color:"red",height:510}}})})})})})]})}})})]}):null})]})})})}}])}(s.Component),J={clearPopupDataAction:I.Uc},H=(0,_.Ng)(null,J)((0,Y.A)(function(e){return{card:{maxWidth:416,height:"100%",margin:"auto"},media:{height:230},header:{paddingBottom:"0rem"},learnMore:{position:"absolute",bottom:0},cardCol:{height:220,marginTop:25,marginBottom:15}}})(q)),X=a(95177),K=a(96815),$=a(23319),Q=a(90053),ee=a(90179),te=a(57059),ae=a(95967),se=a(13682),re=a(55072),ne=a(3200),le=a(2063),ie=function(e){var t=e.graphType,a=e.handleGraphChange,r=e.drilldownFromFun,n=[{value:"column",label:"Bar"},{value:"line",label:"Line"}].concat((0,d.A)(!1===r?[{value:"stack",label:"Stack"}]:[])),l=(0,s.useCallback)(function(e){return(0,b.A)((0,b.A)({},e),{},{borderRadius:0,cursor:"pointer",colors:(0,b.A)((0,b.A)({},e.colors),{},{primary25:"#5DBFC4",primary:"#147b82"})})},[]),i=(0,s.useCallback)(function(e){a(e.value)},[a]);return(0,R.jsx)(le.default,{theme:l,value:n.find(function(e){return e.value===t}),onChange:i,options:n})},oe=a(8171),de=a(99734),ce=a(99859),ue=a(16582),he=a(8358),pe=a.n(he),me=a(42869),ge=a.n(me),be=a(41108),fe=a.n(be),xe=a(26243),ve=a.n(xe);fe()(pe()),ve()(pe());var ye=["January","February","March","April","May","June","July","August","September","October","November","December"],De={January:1,February:2,March:3,April:4,May:5,June:6,July:7,August:8,September:9,October:10,November:11,December:12},we=function(e){function t(e){var a;(0,h.A)(this,t),(a=(0,m.A)(this,t,[e])).displayTableOnLastDrilldown=function(e){a.props.displayDataTableFromBar(e.point.dataId,e.point.name)},a.addDrilldownSeries=function(e){var t=a.props.user.roles[0].role;a.state.chartObj.showLoading("Loading ..."),a.setState({allowChartUpdate:!1});var s=(new Date).getFullYear(),r="",n="",l={};if("day"===a.props.parameters.duration_type){var i,o;if(1===a.state.xAxisData.length){var d=a.state.drilldownCount+1;a.setState({drilldownCount:d}),r=a.props.parameters.start_date&&k()(a.props.parameters.start_date).isValid()?new Date(a.props.parameters.start_date):(0,K.cn)(),n=a.props.parameters.end_date&&k()(a.props.parameters.end_date).isValid()?new Date(a.props.parameters.end_date):(0,K.bJ)()}l.start_date=r,l.end_date=n,"Label"===a.props.dashboardGraphName?l.selected_model_labels_list=e.point.name:l.selected_event_list=e.point.name,l.duration_type="hour",l.camera_id=null===(i=a.props)||void 0===i||null===(o=i.parameters)||void 0===o?void 0:o.camera_id,l.location_id=a.props.locationId,a.state.xAxisData&&2!==a.state.xAxisData.length&&(0,A.Jf)(l,t,a.props.dashboardGraphName).then(function(t){if(t.data.length>0){var s=t.data,r=[],n=s[0];if(Object.entries(n).map(function(e){var t=(0,u.A)(e,2),a=t[0];t[1];r.push(a)}),"hour"===l.duration_type){var i=[],o=s;s.map(function(e,t){return o[t]._id=a.convertDateFromUTCToLocal(e._id),i.push(o[t]._id),null}),i.sort(function(e,t){return new Date("1970/01/01 "+e)-new Date("1970/01/01 "+t)}),o.sort(function(e,t){return new Date("1970/01/01 "+e._id)-new Date("1970/01/01 "+t._id)}),s=o}var d=r.indexOf("_id");d>-1&&r.splice(d,1);var c=r.indexOf("id");c>-1&&r.splice(c,1);for(var h=[],p=0;p<r.length;p++){var m=r[p];h.push({name:m,data:[]})}for(var g=[],b=0;b<s.length;b++){var f=s[b];g.push(f._id)}for(var x=0;x<r.length;x++)for(var v=0;v<s.length;v++){var y=s[v],D=y[r[x]];for(var w in h)r[x]===h[w].name&&h[w].data.push({name:r[x],y:D,drilldown:!1,dataId:y.id})}var A=a.state.xAxisData;A.push(g);var _=a.state.yAxisData;_.push(h),a.setState({xAxisData:A,yAxisData:_},function(){});var j=g.length-1,L=g.length>5?g.length-5:0;a.props.setXAxisYAxisAfterDrilldown(g,h[0],!0),a.state.chartObj.addSeriesAsDrilldown(e.point,h[0]),a.state.chartObj.xAxis[0].update({categories:g,min:L,max:j,scrollbar:{enabled:g.length>5}}),a.state.chartObj.hideLoading()}else a.state.chartObj.hideLoading(),console.log("No Data Found"),a.setState({graphMessage:"No Data Found"})}).catch(function(e){a.state.chartObj.hideLoading(),e.detail&&console.log(e.detail)})}else{var c,h;if(1===a.state.xAxisData.length)if(a.props.parameters.selected_model_labels_list){if(a.props.parameters.start_date&&k()(a.props.parameters.start_date).isValid()){var p=e.point.category.split("-"),m=a.props.parameters.start_date.split("T")[0].split("-");if(Number(m[1])===De[p[0]])c=new Date(a.props.parameters.start_date);else{var g=e.point.category.split("-");c=k()(new Date(g.join("-"))).subtract(1,"days").format("YYYY-MM-DD")+"T18:30:00.000Z"}}else{var b=e.point.category.split("-");c=k()(new Date(b.join("-"))).subtract(1,"days").format("YYYY-MM-DD")+"T18:30:00.000Z"}if(a.props.parameters.end_date&&k()(a.props.parameters.end_date).isValid()){var f=e.point.category.split("-"),x=a.props.parameters.end_date.split("T")[0].split("-");if(Number(x[1])===De[f[0]])h=new Date(a.props.parameters.end_date);else{var v=e.point.category.split("-"),y=v[1],D=De[v[0]],w=new Date(y,D,0);h=k()(new Date(w)).format("YYYY-MM-DD")+"T18:29:59.000Z"}}else{var _=e.point.category.split("-"),j=_[1],L=De[_[0]],S=new Date(j,L,0);h=k()(new Date(S)).format("YYYY-MM-DD")+"T18:29:59.000Z"}"Label"===a.props.dashboardGraphName?l.selected_model_labels_list=e.point.name:l.selected_event_list=e.point.name;var C=a.state.drilldownCount+1;a.setState({drilldownCount:C}),r=c,n=h,l.duration_type="day"}else{var N,F;if(a.props.parameters.start_date&&k()(a.props.parameters.start_date).isValid()){var T=e.point.category.split("-"),M=a.props.parameters.start_date.split("T")[0].split("-");if(Number(M[1])===De[T[0]])N=new Date(a.props.parameters.start_date);else{var Y=e.point.category.split("-");N=k()(new Date(Y.join("-"))).subtract(1,"days").format("YYYY-MM-DD")+"T18:30:00.000Z"}}else{var I=e.point.category.split("-");N=k()(new Date(I.join("-"))).subtract(1,"days").format("YYYY-MM-DD")+"T18:30:00.000Z"}if(a.props.parameters.end_date&&k()(a.props.parameters.end_date).isValid()){var P=e.point.category.split("-"),V=a.props.parameters.end_date.split("T")[0].split("-");if(Number(V[1])===De[P[0]])F=new Date(a.props.parameters.end_date);else{var O=e.point.category.split("-"),z=O[1],G=De[O[0]],E=new Date(z,G,0);F=k()(new Date(E)).format("YYYY-MM-DD")+"T18:29:59.000Z"}}else{var B=e.point.category.split("-"),R=B[1],U=De[B[0]],Z=new Date(R,U,0);F=k()(new Date(Z)).format("YYYY-MM-DD")+"T18:29:59.000Z"}if(!k()(N).isValid()&&!k()(F).isValid()){var W=e.point.category.split("-"),q=k()(new Date(W.join("-"))).subtract(1,"days").format("YYYY-MM-DD");s=W[1];var J=De[W[0]];N=q+"T18:30:00.000Z";var H=new Date(s,J,0);F=k()(new Date(H)).format("YYYY-MM-DD")+"T18:29:59.000Z"}"Label"===a.props.dashboardGraphName?l.selected_model_labels_list=e.point.name:l.selected_event_list=e.point.name;var X=a.state.drilldownCount+1;a.setState({drilldownCount:X}),r=N,n=F,l.duration_type="day"}else if(2===a.state.xAxisData.length){var $,Q;if(a.props.parameters.selected_model_labels_list){var ee=e.point.category.split("-"),te=k()(new Date(ee.join("-"))).subtract(1,"days"),ae=k()(new Date(ee.join("-"))),se=te.format("YYYY-MM-DD"),re=ae.format("YYYY-MM-DD");$=a.props.parameters.start_date.split("T")[0]===re?new Date(a.props.parameters.start_date):se+"T18:30:00.000Z",Q=a.props.parameters.end_date.split("T")[0]===re?new Date(a.props.parameters.end_date):re+"T18:29:59.000Z","Label"===a.props.dashboardGraphName?l.selected_model_labels_list=e.point.name:l.selected_event_list=e.point.name;var ne=a.state.drilldownCount+1;a.setState({drilldownCount:ne}),r=$,n=Q,l.duration_type="hour"}else{var le,ie;if(a.props.parameters.start_date&&k()(a.props.parameters.start_date).isValid()){var oe=e.point.category.split("-"),de=a.props.parameters.start_date.split("T")[0].split("-");if(Number(de[1])===De[oe[0]])le=new Date(a.props.parameters.start_date);else{var ce=e.point.category.split("-");le=k()(new Date(ce.join("-"))).subtract(1,"days").format("YYYY-MM-DD")+"T18:30:00.000Z"}}else{var ue=e.point.category.split("-");le=k()(new Date(ue.join("-"))).subtract(1,"days").format("YYYY-MM-DD")+"T18:30:00.000Z"}if(a.props.parameters.end_date&&k()(a.props.parameters.end_date).isValid()){var he=e.point.category.split("-"),pe=a.props.parameters.end_date.split("T")[0].split("-");if(Number(pe[1])===De[he[0]])ie=new Date(a.props.parameters.end_date);else{var me=e.point.category.split("-");ie=k()(new Date(me.join("-"))).format("YYYY-MM-DD")+"T18:29:59.000Z"}}else{var ge=e.point.category.split("-");ie=k()(new Date(ge.join("-"))).format("YYYY-MM-DD")+"T18:29:59.000Z"}if(!k()(le).isValid()&&!k()(ie).isValid()){var be=e.point.category.split("-"),fe=k()(new Date(be.join("-"))).subtract(1,"days"),xe=k()(new Date(be.join("-")));le=fe.format("YYYY-MM-DD")+"T18:30:00.000Z",ie=xe.format("YYYY-MM-DD")+"T18:29:59.000Z"}"Label"===a.props.dashboardGraphName?l.selected_model_labels_list=e.point.name:l.selected_event_list=e.point.name;var ve=a.state.drilldownCount+1;a.setState({drilldownCount:ve}),r=le,n=ie,l.duration_type="hour"}}l.start_date=r,l.end_date=n,l.camera_id=a.props.cameraId,l.location_id=a.props.locationId,l.selected_model_labels_list=a.props.selected_model_labels_list,"Label"===a.props.dashboardGraphName?l.selected_model_labels_list=e.point.name:l.selected_event_list=e.point.name,a.state.xAxisData&&3!==a.state.xAxisData.length&&(0,A.Jf)(l,t,a.props.dashboardGraphName).then(function(t){if(t.data.length>0){var s=t.data,r=[];if("hour"===l.duration_type){var n=s;s.map(function(e,t){return n[t]._id=a.convertDateFromUTCToLocal(e._id),r.push(n[t]._id),null}),r.sort(function(e,t){return new Date("1970/01/01 "+e)-new Date("1970/01/01 "+t)}),n.sort(function(e,t){return new Date("1970/01/01 "+e._id)-new Date("1970/01/01 "+t._id)}),s=n}var i=[],o=s[0];Object.entries(o).map(function(e){var t=(0,u.A)(e,2),a=t[0];t[1];i.push(a)});var d=i.indexOf("_id");if(d>-1&&i.splice(d,1),"hour"===l.duration_type){var c=i.indexOf("id");c>-1&&i.splice(c,1)}for(var h=[],p=0;p<i.length;p++){var m=i[p];h.push({name:m,data:[]})}for(var g=[],b=0;b<s.length;b++){var f=s[b];if("hour"===l.duration_type){var x=a.convertDateFromUTCToLocal(f._id);x=x,g.push(f._id)}else g.push(f._id)}for(var v=0;v<i.length;v++)for(var y=0;y<s.length;y++){var D=s[y],w=D[i[v]];for(var A in h)if(i[v]===h[A].name){var _=w>0?w:0;h[A].data.push({name:i[v],y:_,drilldown:"day"===l.duration_type,dataId:D.id})}}var j=a.state.xAxisData;j.push(g);var L=a.state.yAxisData;L.push(h),a.setState({xAxisData:j,yAxisData:L},function(){});var S=g.length-1,C=g.length>5?g.length-5:0;a.props.setXAxisYAxisAfterDrilldown(g,h[0],!0),a.state.chartObj.addSeriesAsDrilldown(e.point,h[0]),a.state.chartObj.xAxis[0].update({categories:g,min:C,max:S,scrollbar:{enabled:g.length>5}}),a.state.chartObj.hideLoading()}else a.state.chartObj.hideLoading(),console.log("No Data Found"),a.setState({graphMessage:"No Data Found"})}).catch(function(e){a.state.chartObj.hideLoading(),e.detail&&console.log("error",e)})}},a.convertDateFromUTCToLocal=function(e){var t=e.split(":").map(Number),a=(0,u.A)(t,3),s=a[0],r=a[1],n=a[2],l=new Date;return l.setHours(s,r,n),l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})},a.addDrillUpSeries=function(e){a.props.displayDataTableFromBar(null);var t=a.state.drilldownCount-1;a.setState({drilldownCount:t});var s=a.state.xAxisData,r=a.state.yAxisData,n=s[t].length-1,l=s[t].length>5?s[t].length-5:0;a.state.chartObj.xAxis[0].update({categories:s[t],min:l,max:n,scrollbar:{enabled:s[t].length>5}}),s.splice(t+1,1),r.splice(t+1,1);var i=!0;0===t&&(i=!1),a.props.setXAxisYAxisAfterDrilldown(s[t],r[t],i),a.setState({xAxisData:s,yAxisData:r})},a.chartCallback=function(e){a.setState({chartObj:e}),pe().Tick.prototype.drillable=function(){}};var s,r=(s=a.props.xAxis,"month"!==a.props.parameters.duration_type?s:s.map(function(e){var t=e.split("-"),a=(0,u.A)(t,2),s=a[0],r=a[1];return"".concat(ye[r-1],"-").concat(s)})),n=r.length-1,l=function(e){return e>5?e-5:0}(r.length);!function(e){var t=Math.min.apply(Math,(0,d.A)(e));Math.max.apply(Math,(0,d.A)(e))}(a.props.yAxis.flat());return a.state={allowChartUpdate:!0,xAxisData:[r],yAxisData:[a.props.yAxis],drilldownCount:0,options:{chart:{type:"column",scrollablePlotArea:{scrollPositionX:1},events:{drilldown:a.addDrilldownSeries.bind(a),drillupall:a.addDrillUpSeries.bind(a)}},credits:{enabled:!1},xAxis:{categories:r,min:l,max:n,scrollbar:{enabled:r.length>5}},yAxis:{type:"logarithmic"},title:{text:""},legend:{enabled:!0},plotOptions:{series:{turboThreshold:0,cursor:"pointer",events:{legendItemClick:function(e){e.preventDefault()}},point:{events:{click:a.displayTableOnLastDrilldown.bind(a)}}},column:{pointPadding:.2,borderWidth:0}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y}</b> of total<br/>'},series:a.props.yAxis}},a}return(0,g.A)(t,e),(0,p.A)(t,[{key:"componentDidUpdate",value:function(e,t,a){var s=e.graphType,r=this.props.graphType,n=this.state.chartObj;this.props.dashboardGraphName;if(s!==r&&void 0!==n){var l=r;"stack"===r?(l="column",this.state.chartObj.update({chart:{type:l},plotOptions:{column:{stacking:"normal",grouping:!1}}})):this.state.chartObj.update({chart:{type:l},plotOptions:{column:{grouping:!0,stacking:!1}}})}}},{key:"render",value:function(){return(0,R.jsx)(s.Fragment,{children:(0,R.jsx)(F.A,{children:(0,R.jsx)(T.A,{xl:12,children:(0,R.jsx)(ge(),{highcharts:pe(),options:this.state.options,callback:this.chartCallback,allowChartUpdate:this.state.allowChartUpdate})})})})}}])}(s.Component);var Ae=(0,_.Ng)(function(e){return{user:e.auth.user}},j.o1)(we),_e=a(20737),je=a(12682),Le=a(53493),Se=function(e){var t=e.options,a=e.currSizePerPage,s=e.onSizePerPageChange;return(0,R.jsx)("div",{className:"btn-group",children:t.map(function(e){return(0,R.jsx)("button",{type:"button",onClick:function(){return s(e.value)},className:"btn ".concat(a===e.value?"btn-primary":"btn-secondary"),children:e.text},e.text)})})};function Ce(e){var t=e.listLoading,a=e.tableData,r=e.pageParams,n=e.queryParams,l=e.filterEntities,i=e.columns,o=e.setQueryParams,d=(0,s.useCallback)(function(e,t){var a=t.page,s=t.sizePerPage,r=t.sortField,l=t.sortOrder,i={pageNumber:"sizePerPage"===e?1:a,pageSize:s||n.pageSize||10,sortField:r,sortOrder:l};o(i)},[o,n.pageSize]);return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"mt-3 mb-5"}),(0,R.jsx)(S(),{tag:"div",blocking:t,color:"#147b82",children:a&&l&&l.length>0?(0,R.jsx)(_e.gx,{pagination:(0,_e.Ay)((0,b.A)((0,b.A)({},(0,f.lh)(r.totalCounts,n)),{},{page:n.pageNumber,sizePerPage:n.pageSize,totalSize:r.totalCounts,custom:!0,sizePerPageList:[{text:"10",value:10},{text:"50",value:50},{text:"100",value:100}],sizePerPageRenderer:Se})),children:function(e){var a=e.paginationProps,s=e.paginationTableProps;return(0,R.jsx)(je.dK,{isLoading:t,paginationProps:a,children:(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(Q.A,{children:(0,R.jsx)(ee.A,{xl:12,style:{padding:"10px 40px 10px 40px",minWidth:"300px"},children:(0,R.jsx)("div",{style:{height:"400px",overflowY:"auto",overflowX:"hidden"},children:(0,R.jsxs)(N.A,(0,b.A)((0,b.A)({wrapperClasses:"table-responsive",bordered:!1,classes:"table employeeTable table-head-custom table-vertical-center table-horizontal-center overflow-hidden",bootstrap4:!0,remote:!0,keyField:"_id.$oid",data:l||[],columns:i,defaultSorted:Le.Nz,onTableChange:d},s),{},{children:[(0,R.jsx)(f.Hd,{entities:l}),(0,R.jsx)(f.Rt,{entities:l})]}))})})})})})}}):(0,R.jsx)("div",{style:{minHeight:"calc(100vh - 405px)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,R.jsx)("h4",{className:"text-center mb-0",children:"No Data Found"})})})]})}var Ne=a(17598),Fe=a(47766),Te=function(e){var t=e.row,a=e.openViewMyResultDialog;return(0,R.jsx)("a",{title:"Information",className:"btn btn-icon btn-light btn-sm mx-3",onClick:function(){return a(t._id.$oid,t)},style:{cursor:"pointer"},children:(0,R.jsx)(Fe.A,{color:"action",style:{fontSize:"2rem",color:"#147b82"}})})};var Me={option:function(e,t){return(0,b.A)((0,b.A)({},e),{},{cursor:"pointer"})},control:function(e){return(0,b.A)((0,b.A)({},e),{},{cursor:"pointer"})}},ke=new Date,Ye=k()(new Date(ke.getFullYear(),ke.getMonth(),ke.getDate(),0,0,0,0)),Ie=(k()(Ye).add(1,"days").subtract(1,"seconds"),{label:"Select Model",value:0}),Pe=function(e){function t(e){var a,s;return(0,h.A)(this,t),(a=(0,m.A)(this,t,[e])).setWidgetLabelAndValue=function(e){var t=a.props.user.roles[0].role;a.setState({widgetLoader:!0}),t===X.lc?(0,A.g)(e).then(function(e){var t=e.data,s=[];Object.entries(t).map(function(e){var t=(0,u.A)(e,2),a=t[0];t[1];s.push(a)});var r=a.formatWidgetData(s,[]);a.setState({widget:t,keys:r.arrayData,widgeTitle:r.titleData,widgetLoader:!1})}).catch(function(e){a.setState({widgetLoader:!1}),console.log(e||"Something went wrong")}):t===X.Gm?(a.setState({widgetLoader:!0}),(0,A.vt)(e).then(function(e){var t=e.data,s=[];Object.entries(t).map(function(e){var t=(0,u.A)(e,2),a=t[0];t[1];s.push(a)});var r=a.formatWidgetData(s,[]);a.setState({widget:t,keys:r.arrayData,widgeTitle:r.titleData,widgetLoader:!1})}).catch(function(e){a.setState({widgetLoader:!1}),console.log(e||"Something went wrong")})):t===X.NY&&(a.setState({widgetLoader:!0}),(0,A.xY)(e).then(function(e){var t=e.data,s=[];Object.entries(t).map(function(e){var t=(0,u.A)(e,2),a=t[0];t[1];s.push(a)});var r=a.formatWidgetData(s,[]);a.setState({widget:t,keys:r.arrayData,widgeTitle:r.titleData,widgetLoader:!1})}).catch(function(e){a.setState({widgetLoader:!1}),console.log(e||"Something went wrong")}))},a.formatWidgetData=function(e,t){var a,s=(0,c.A)(e);try{for(s.s();!(a=s.n()).done;){for(var r=a.value.split("_"),n=0;n<r.length;n++)r[n]=r[n][0].toUpperCase()+r[n].substr(1);var l=r.join(" ");t.push(l)}}catch(i){s.e(i)}finally{s.f()}return{titleData:t,arrayData:e}},a.handleGraphChange=function(e){a.setState({graphType:e})},a.loadInitialGraph=function(){var e=(0,K.cn)(),t=(0,K.bJ)();a.setState({setFilterParameters:!1,loadInitialGraphFlag:!0,showBarTable:!1,graphType:"column",drilldownFromFun:!1,parameters:{},notice:!1,pageParams:{pageSize:10,totalPages:0,totalCounts:0},queryParams:{pageNumber:1,pageSize:10,sortField:null,sortOrder:null},startDate:e,endDate:t},function(){a.setFilterParameters({start_date:e,end_date:t,current_date:(0,K.ZD)(),duration_type:"day",initial_graph:!0,location_id:a.state.selectedLocationValue,camera_id:a.state.selectedCameraValue,selected_model_labels_list:a.state.selectedLabelValue},"Today's "+a.state.dashboardGraphName+" Data Analysis",!1),a.getMyResultMetadata(k().utc(e).format(),k().utc(t).format())})},a.loadAllYearData=function(){a.setState({loadInitialGraphFlag:!1,showBarTable:!1,graphType:"column",drilldownFromFun:!1,notice:!1,loadAlldata:!0,pageParams:{pageSize:10,totalPages:0,totalCounts:0},queryParams:{pageNumber:1,pageSize:10,sortField:null,sortOrder:null}},function(){a.handleLocationChange([{label:"All Location",value:"-1"}])}),a.setState({show:!1}),setTimeout(function(){a.setState({show:!0})},100),a.getMyResultMetadata(),a.setFilterParameters({camera_id:a.state.selectedCameraValue,duration_type:"month"},a.state.dashboardGraphName+" Data Analysis",!1);var e={current_date:(0,K.ZD)(),location_id:a.state.selectedLocationValue,camera_id:a.state.selectedCameraValue,selected_model_labels_list:a.state.selectedLabelValue,duration_type:"day",initial_graph:!0};a.setWidgetLabelAndValue(e)},a.setFilterParameters=function(e,t,s){a.setState({loading:!0,xAxis:[],yAxis:[],showGraph:!1,graphMessage:"Loading..."});var r=a.props.user.roles[0].role;(0,A.Jf)(e,r,a.state.dashboardGraphName).then(function(r){r&&r.data.length>0?a.handleGraphDataSuccess(r.data,e,t,s):a.handleGraphDataEmpty()}).catch(function(e){a.handleGraphDataError(e)})},a.handleGraphDataSuccess=function(e,t,s,r){a.setState({blocking:!1});var n=a.transformGraphData(e),l=n.xAxis,i=n.series,o="day"===t.duration_type;a.setState({xAxis:l,yAxis:i,blocking:!1,startDateEndDateFlag:!1,initialGraph:o,showGraph:!0,title:s,parameters:t,drillApplied:r,loading:!1,graphMessage:"No Data Found"})},a.transformGraphData=function(e){var t=e[0],a=Object.keys(t).filter(function(e){return"_id"!==e}),s=a.map(function(e){return{name:e,data:[]}}),r=e.map(function(e){return e._id});return a.forEach(function(t){e.forEach(function(e){var a=e[t],r=s.find(function(e){return e.name===t});r&&r.data.push({name:t,y:a,drilldown:!0})})}),{labels:a,xAxis:r,series:s}},a.handleGraphDataEmpty=function(){a.setState({showGraph:!1,graphMessage:"No Data Found",xAxis:[],yAxis:[]})},a.handleGraphDataError=function(e){console.log(e),a.setState({showGraph:!1,graphMessage:"No Data Found",xAxis:[],yAxis:[]})},a.setXAxisYAxisAfterDrilldown=function(e,t,s){a.setState({xAxis:e,yAxis:t,drilldownFromFun:s})},a.displayDataTableFromBar=function(e,t){e&&""!==e?(a.setState({showBarTable:!1,blocking:!0}),(0,A.sV)(e,null,a.state.dashboardGraphName).then(function(e){e&&e.isSuccess&&a.setState({tableData:e.data},function(){a.setState({showBarTable:!0,blocking:!1})})}).catch(function(e){a.setState({showBarTable:!1,blocking:!1}),console.log(e||"Something went wrong")})):a.setState({showBarTable:!1,blocking:!1})},a.dateTimeRangeChangeHandler=function(e,t){a.setState({startDate:k().utc(e).format(),endDate:k().utc(t).format()})},a.dateTimeRangeIndexChangeHandler=function(e,t){var s=(0,ae.A)(t),r=(0,se.A)(parseInt(s,10)),n=a.state.startDate,l=a.state.endDate,i=a.state.minDate,o=a.state.maxDate;12===parseInt(s)&&(n=parseInt("defaultMin",0),l=parseInt("defaultMax",0),i=["min"],o=["max"]),a.setState({typeValue:s,selectedIndex:r,startDate:n,endDate:l,minDate:i,maxDate:o})},a.validateFilterSelections=function(e,t,s){return e.length<1&&t.length<1&&s.length<1?((0,C.Au)("Please select all filter"),!1):e.length<1?((0,C.Au)("Please select location"),!1):t.length<1?((0,C.Au)("Please select camera"),!1):!(s.length<1&&t.length>0)||("Label"===a.state.dashboardGraphName?(0,C.Au)("Please select label"):(0,C.Au)("Please select type"),!1)},a.buildFilterParams=function(e,t,s,r,n){var l={};return l.location_id=e,l.camera_id=t,s.length>0&&("Label"===a.state.dashboardGraphName?l.selected_model_labels_list=s:l.selected_event_list=s),r&&(l.start_date=r),n&&(l.end_date=n),l},a.setDurationType=function(e,t){if(e.hasOwnProperty("start_date")&&e.hasOwnProperty("end_date")){var a=new Date(e.start_date),s=new Date(e.end_date);e.hasOwnProperty("no_date_selected")||t?e.duration_type="day":(a.getMonth()===s.getMonth()&&(a.getFullYear(),s.getFullYear()),e.duration_type="month")}else e.duration_type="month";return e},a.handleWidgetAndFilter=function(e,t,s,r){var n={start_date:a.state.startDate,end_date:a.state.endDate,current_date:(0,K.ZD)(),deployed_rtsp_job_id:0,camera_id:s,selected_model_labels_list:r,duration_type:"day",initial_graph:!0,location_id:t};a.setWidgetLabelAndValue(n),a.setFilterParameters(e,a.state.dashboardGraphName+" Data Analysis",!1),a.getMyResultMetadata(k().utc(a.state.startDate).format(),k().utc(a.state.endDate).format())},a.applyFilter=function(e,t){a.setState({pageParams:{pageSize:10,totalPages:0,totalCounts:0},queryParams:{pageNumber:1,pageSize:10,sortField:null,sortOrder:null},loadAlldata:!1});var s=k().utc(a.state.startDate).format(),r=k().utc(a.state.endDate).format(),n=a.state.selectedLocationValue,l=a.state.selectedCameraValue,i=a.state.selectedLabelValue;if(a.validateFilterSelections(n,l,i)){var o=a.buildFilterParams(n,l,i,s,r);o=a.setDurationType(o,a.state.isSameDate),n.length>0&&l.length>0&&i.length>0&&a.handleWidgetAndFilter(o,n,l,i),a.setState({show:!1}),setTimeout(function(){a.setState({show:!0})},100)}},a.clearFilter=function(){a.setState({startDate:(0,K.cn)(),endDate:(0,K.bJ)(),selectedLocationValue:["-1"],selectedCameraValue:["-1"],selectedLabelValue:"-1",selectedIndex:0,notice:!1,allLabelFlag:!0,pageParams:{pageSize:10,totalPages:0,totalCounts:0},queryParams:{pageNumber:1,pageSize:10,sortField:null,sortOrder:null}},function(){a.handleLocationChange([{label:"All Location",value:"-1"}]);var e={start_date:(0,K.cn)(),end_date:(0,K.bJ)(),current_date:(0,K.ZD)(),deployed_rtsp_job_id:0,location_id:a.state.selectedLocationValue,camera_id:a.state.selectedCameraValue,selected_model_labels_list:a.state.selectedLabelValue,duration_type:"day",initial_graph:!0};a.setWidgetLabelAndValue(e),a.loadInitialGraph();var t=k().utc((0,K.cn)()).format(),s=k().utc((0,K.bJ)()).format();a.setState({show:!1}),setTimeout(function(){a.setState({show:!0})},100),a.getMyResultMetadata(t,s)})},a.getAllLocations=function(){var e=a.props.user.roles[0].role;a.setState({locationLoading:!0}),(0,re.dr)(e).then(function(e){if(e&&e.data){var t=[];e.data.map(function(e){return t.push({label:e.location_name,value:e.id})}),t.push({label:"All Location",value:"-1"}),a.setState({locationOptions:t,locationLoading:!1},function(){a.handleLocationChange([{label:"All Location",value:"-1"}])})}}).catch(function(e){a.setState({locationLoading:!1}),e.detail&&console.log(e.detail)})},a.processCameraOptions=function(e){var t=[],a=[];return e.data.map(function(e){return t.push({label:e.camera_name,value:e.id}),a.push(e.camera_name),null}),t.push({label:"All Camera",value:"-1"}),{cameraOptions:t,camerasIds:a}},a.resetCameraAndLabel=function(){a.setState({selectedLabel:[],selectedLabelValue:[],selectedCamera:[],selectedCameraValue:[]})},a.handleCameraAndLabelAfterFetch=function(e){"Label"===e?a.handleCameraChange([{label:"All Camera",value:"-1"}]):"Event"===e&&a.handleCameraChangeForEventType([{label:"All Camera",value:"-1"}]),a.setState({selectedLabel:[],selectedLabelValue:"-1",labelOptions:[]})},a.handleCameraFetchError=function(e){a.setState({blocking:!1}),e.detail&&console.error(e.detail)},a.handleLocationChange=function(e){null!==e&&0!==e.length||a.resetCameraAndLabel();var t=[];if(e){var s,r=(0,c.A)(e);try{for(r.s();!(s=r.n()).done;){var n=s.value;t.push(n.value.toString())}}catch(l){r.e(l)}finally{r.f()}}a.setState({selectedLocation:e,selectedLocationValue:t},function(){var e=a.props.user.roles[0].role;a.state.selectedLocationValue&&a.state.selectedLocationValue.length>0&&(0,A.if)(a.state.selectedLocationValue,e).then(function(e){if(e&&e.isSuccess){var t=a.processCameraOptions(e),s=t.cameraOptions,r=t.camerasIds,n=a.createCameraNameMap(s);a.setState({cameraOptions:s,camerasIds:r,cameraName:n},function(){a.handleCameraAndLabelAfterFetch(a.state.dashboardGraphName)})}else a.handleCameraFetchError({})}).catch(function(e){a.handleCameraFetchError(e)})})},a.processLabelOptionsForCamera=function(e){var t=e.data.flatMap(function(e){return e.labels});return t.push("All Label"),Array.from(new Set(t)).map(function(e){return{label:(0,P.G)(e),value:"All Label"===e?"-1":e}})},a.createCameraNameMap=function(e){var t={};return e.forEach(function(e){"-1"!==e.value&&(t[e.value]=e.label)}),t},a.handleLabelFetchError=function(e){a.setState({labelLoading:!1}),e.detail&&console.log(e.detail)},a.processEventTypeLabelOptions=function(e){var t=e.data.map(function(e){return e});t.push("All Type");var a=[];return t.forEach(function(e){e.split(",").forEach(function(e){return a.push(e)})}),Array.from(new Set(a)).map(function(e){return{label:e,value:"All Type"===e?"-1":e}})},a.handleCameraChange=function(e){var t=[];if(e){var s,r=(0,c.A)(e);try{for(r.s();!(s=r.n()).done;){var n=s.value;t.push(n.value.toString())}}catch(l){r.e(l)}finally{r.f()}}a.setState({selectedCamera:e,selectedCameraValue:t},function(){var e=a.props.user.roles[0].role;if(a.state.selectedCameraValue&&a.state.selectedCameraValue.length>0){a.setState({labelLoading:!0});var t={camera_id:a.state.selectedCameraValue,location_id:a.state.selectedLocationValue};(0,ne.gm)(t,e).then(function(e){if(e&&e.isSuccess){var t=a.processLabelOptionsForCamera(e),s=a.createCameraNameMap(a.state.cameraOptions);a.setState({labelLoading:!1,cameraName:s},function(){a.setState({labelOptions:t},function(){a.handleLabelChange([{label:"All Label",value:"-1"}]),a.setState({allLabelFlag:!1})})})}else a.handleLabelFetchError({})}).catch(function(e){a.handleLabelFetchError(e)})}else a.setState({selectedLabel:""})})},a.handleCameraChangeForEventType=function(e){var t=[];if(e){var s,r=(0,c.A)(e);try{for(r.s();!(s=r.n()).done;){var n=s.value;t.push(n.value.toString())}}catch(l){r.e(l)}finally{r.f()}}a.setState({selectedCamera:e,selectedCameraValue:t},function(){if(a.state.selectedCameraValue&&a.state.selectedCameraValue.length>0){a.setState({labelLoading:!0});var e={camera_id_list:a.state.selectedCameraValue,location_id_list:a.state.selectedLocationValue};(0,A.Cf)(e).then(function(e){if(e&&e.isSuccess){var t=a.processEventTypeLabelOptions(e);a.setState({labelLoading:!1},function(){a.setState({labelOptions:t},function(){a.handleTypeChange([{label:"All Type",value:"-1"}]),a.setState({allLabelFlag:!1})})})}else a.handleLabelFetchError({})}).catch(function(e){a.handleLabelFetchError(e)})}else a.setState({selectedLabel:"",labelOptions:[]})})},a.handleTypeChange=function(e){var t="";if(e)if(1===e.length)t="".concat(e[0].value);else for(var s=0;s<e.length;s++)t+="".concat(e[s].value),s!==e.length-1&&(t+=",");a.setState({selectedLabel:e,selectedLabelValue:t})},a.handleLabelChange=function(e){var t="";if(e)if(1===e.length)t="".concat(e[0].value);else for(var s=0;s<e.length;s++)t+="".concat(e[s].value),s!==e.length-1&&(t+=",");a.setState({selectedLabel:e,selectedLabelValue:t})},a.getMyResultMetadata=function(e,t){var s,r,n=a.state,l=n.selectedLabelArray,i=n.selectedCameraValue,o=n.selectedLocationValue,d=n.queryParams;(0,Ne.t)(e,t,l,i,o,d.pageSize,null===(s=a.props.user)||void 0===s||null===(r=s.roles[0])||void 0===r?void 0:r.role).then(function(s){if(!s||!s.isSuccess)throw a.setState({listLoading:!1}),new Error;a.setState({pageParams:{pageSize:s.data.page_size,totalPages:s.data.total_pages,totalCounts:s.data.total_count}},function(){a.getMyResults(e,t)})}).catch(function(e){a.setState({listLoading:!1}),console.log(e.detail||"Something went Wrong")})},a.getMyResults=function(e,t){var s,r,n=a.state,l=n.jobId,i=n.selectedCameraValue,o=n.selectedLabelArray,c=n.selectedLocationValue,u=n.queryParams;a.setState({listLoading:!0});var h=u.pageSize||10,p=u.pageNumber||1,m=null===(s=a.props.user)||void 0===s||null===(r=s.roles[0])||void 0===r?void 0:r.role,g={pageSize:h,pageNo:p,jobId:null===l||void 0===l?void 0:l.value,startDate:e,endDate:t,selctedcameraid:i,selectedLabel:o,locationIdList:c,userRole:m};(0,Ne.h)(g).then(function(e){if(!e||!e.isSuccess)throw a.setState({listLoading:!1}),new Error;var t=e.data;(0,d.A)(new Set(t.map(function(e){return e.camera_id}).filter(Boolean))).length>0?a.setState(function(e){return{currentItems:t,filterEntities:t,listLoading:!1,tableData:t.length>0}}):a.setState({listLoading:!1})}).catch(function(e){a.setState({listLoading:!1}),console.log(e.detail||"Something went wrong")})},a.openViewMyResultDialog=function(e,t){a.setState({showBarTable:!1}),setTimeout(function(){a.setState({showBarTable:!0,tableData:[t]})},100)},a.handleSubmit=(0,o.A)((0,i.A)().m(function e(){var t,s,r,n,l;return(0,i.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,a.setState({isDownloading:!0}),t=a.props.userRole,s=a.state.filterEntities.map(function(e){var t;return null===(t=e._id)||void 0===t?void 0:t.$oid}),e.n=1,(0,ne.hr)(s,t);case 1:(r=e.v)&&r.data&&("string"===typeof r.data?(n=a.base64ToBlobUTF8(r.data,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),a.downloadExcelFromBlob(n,"Results.xlsx")):r.data instanceof Blob?a.downloadExcelFromBlob(r.data,"Results.xlsx"):console.error("Invalid response format: not a Blob or base64 string.")),e.n=3;break;case 2:e.p=2,l=e.v,console.error("Error during API call:",l);case 3:return e.p=3,a.setState({isDownloading:!1}),e.f(3);case 4:return e.a(2)}},e,null,[[0,2,3,4]])})),a.base64ToBlobUTF8=function(e,t){for(var a=atob(e),s=new Array(a.length),r=0;r<a.length;r++)s[r]=a.charCodeAt(r);return new Blob([new Uint8Array(s)],{type:t})},a.downloadExcelFromBlob=function(e,t){try{var s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}catch(n){console.error("Error downloading Excel:",n)}finally{a.setState({isDownloading:!1})}},a.setQueryParams=function(e){var t=e.pageSize!==a.state.queryParams.pageSize,s=(0,b.A)((0,b.A)((0,b.A)({},a.state.queryParams),e),{},{pageSize:e.pageSize||a.state.queryParams.pageSize||10,pageNumber:t?1:e.pageNumber||a.state.queryParams.pageNumber||1});a.setState({queryParams:s,listLoading:!0},function(){a.state.loadAlldata?a.getMyResultMetadata():a.getMyResultMetadata(k().utc(a.state.startDate).format(),k().utc(a.state.endDate).format())})},a.state={graphType:"column",graphDuration:"Monthly",modalOpen:!1,showGraph:!1,graphMessage:"No Data Found",widget:null,keys:[],title:[],widgeTitle:null,drilldownFromFun:!1,startDateEndDateFlag:!1,blocking:!1,loadInitialGraphFlag:!0,showBarTable:!1,tableData:[],getTrue:!1,cameraData:{},dashboardGraphName:"Label",currentTabOpenIndex:0,startDate:(0,K.cn)(),endDate:(0,K.bJ)(),minDate:"",maxDate:"",values:[],show:!0,typeValue:12,selectedIndex:12,selectedDataSourceId:null,locationLoading:!1,locationOptions:[],selectedLocation:[],selectedLocationValue:["-1"],totalCamerasByLocationLoading:!1,cameraOptions:[],camerasIds:[],selectedCamera:[],selectedCameraValue:["-1"],labelLoading:!1,labelOptions:[],selectedLabel:[],selectedLabelValue:"-1",loadAlldata:!1,topspinHighchartData:[],mainLoading:!1,topspinFlag:!1,jobId:Ie,loadalldata:!1,listLoadingResult:!1,tableDataResult:!1,isDownloading:!1,pageParams:{pageSize:10,totalPages:0,totalCounts:0},queryParams:{pageNumber:1,pageSize:10,sortField:null,sortOrder:null},currentItems:[],filterEntities:[],showModalResult:!1,row:[],currentPage:1,columns:[{dataField:"idx",text:"Index",sort:!0,formatter:function(e,t,s){return s+1+(a.state.queryParams.pageNumber-1)*a.state.queryParams.pageSize}},{dataField:"camera_name",text:"Camera Name",sort:!0,formatter:function(e,t){return t.camera_name},headerSortingClasses:f.UJ},{dataField:"count",text:"Count",sort:!0,formatter:function(e,t){var a,s;return(null===t||void 0===t||null===(a=t.result)||void 0===a||null===(s=a.detection)||void 0===s?void 0:s.length)||0}},{dataField:"created_date.$date",text:"Created Date",sort:!0,sortCaret:f.iA,headerSortingClasses:f.UJ,formatter:function(e,t){return k().utc(null===t||void 0===t?void 0:t.created_date.$date).local().format("MMMM DD YYYY, h:mm:ss a")}},{dataField:"labels",text:"Labels",sort:!0,formatter:function(e,t){return Object.keys((null===t||void 0===t?void 0:t.counts)||{}).map(function(e){return(0,P.G)(e)}).join(", ")}},{dataField:"action",text:"Actions",formatter:(s=a.openViewMyResultDialog,function(e,t){return(0,R.jsx)(Te,{row:t,openViewMyResultDialog:s})})}],cameraName:{},loading:!0,xAxis:[],yAxis:[]},a}return(0,g.A)(t,e),(0,p.A)(t,[{key:"componentDidMount",value:function(){this.getAllLocations(),this.setState({allLabelFlag:!0});var e={start_date:this.state.startDate,end_date:this.state.endDate,current_date:(0,K.ZD)(),duration_type:"day",initial_graph:!0,location_id:this.state.selectedLocationValue,camera_id:this.state.selectedCameraValue,selected_model_labels_list:this.state.selectedLabelValue};this.setWidgetLabelAndValue(e),this.loadInitialGraph(),this.getMyResultMetadata(k().utc(this.state.startDate).format(),k().utc(this.state.endDate).format())}},{key:"componentWillReceiveProps",value:function(e,t){e.selectedIndex!==this.state.selectedIndex&&this.setState({selectedIndex:e.selectedIndex})}},{key:"componentDidUpdate",value:function(e){var t=this;e.selectedIndex!==this.props.selectedIndex&&this.setState({selectedIndex:this.props.selectedIndex}),e.location.popupData!==this.props.location.popupData&&(this.props.location.popupData&&this.props.location.popupData.length>0?this.setState({showBarTable:!1,blocking:!0,tableData:this.props.location.popupData},function(){t.setState({showBarTable:!0,blocking:!1})}):this.setState({showBarTable:!1}))}},{key:"render",value:function(){var e=this.state,t=e.locationLoading,a=e.locationOptions,s=e.selectedLocation,r=e.totalCamerasByLocationLoading,n=e.cameraOptions,l=e.selectedCamera,i=e.labelLoading,o=e.labelOptions,d=e.selectedLabel;return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(oe.A,{className:"example example-compact",style:{minHeight:"150px",overflow:"visible"},children:(0,R.jsxs)($.A,{style:{padding:"10px 10px"},children:[(0,R.jsxs)(Q.A,{children:[(0,R.jsx)(ee.A,{xl:8,lg:8,xs:12,md:7,sm:12,children:(0,R.jsx)(de.A,{title:"Event Information"})}),(0,R.jsx)(ee.A,{xl:4,lg:4,xs:12,md:5,sm:12,children:(0,R.jsxs)("div",{className:"mt-5 d-flex justify-content-lg-end",children:[!this.state.loadInitialGraphFlag&&(0,R.jsx)(B.A,{color:"primary",className:"mr-4 btn-apply-filter",onClick:this.loadInitialGraph,children:"Load Latest Data"}),this.state.loadInitialGraphFlag&&(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(B.A,{color:"primary",className:"mr-4 btn-apply-filter loadtop",onClick:this.loadAllYearData,children:"Load All Data"})})]})})]}),(0,R.jsx)("hr",{}),(0,R.jsxs)(Q.A,{className:"space",children:[(0,R.jsx)(ee.A,{xl:2,xs:12,md:6,sm:12,children:(0,R.jsxs)(y.A.Group,{className:"mb-3",children:[(0,R.jsx)(y.A.Label,{className:"mb-4",children:"Select Location"}),(0,R.jsx)(x.b,{isLoading:t,isSearchable:!0,isMulti:!0,placeholder:"Select Location",className:"select-react-dropdown",value:s,onChange:this.handleLocationChange,options:a,styles:Me})]})}),(0,R.jsx)(ee.A,{xl:2,xs:12,md:6,sm:12,children:(0,R.jsxs)(y.A.Group,{className:"mb-3",children:[(0,R.jsx)(y.A.Label,{className:"mb-4",children:"Select Camera"}),(0,R.jsx)(x.b,{isMulti:!0,styles:Me,isLoading:r,placeholder:"Select Camera",value:l,onChange:"Label"===this.state.dashboardGraphName?this.handleCameraChange:this.handleCameraChangeForEventType,options:n})]})}),(0,R.jsx)(ee.A,{xl:2,xs:12,md:6,sm:12,children:(0,R.jsxs)(y.A.Group,{className:"mb-3",children:[(0,R.jsx)(y.A.Label,{className:"mb-4",children:"Label"===this.state.dashboardGraphName?"Select Label":"Select Type"}),(0,R.jsx)(x.b,{styles:Me,isLoading:i,isMulti:!0,placeholder:"Label"===this.state.dashboardGraphName?"Select Label":"Select Type",value:d,onChange:"Label"===this.state.dashboardGraphName?this.handleLabelChange:this.handleTypeChange,options:o})]})}),(0,R.jsx)(ee.A,{xl:4,xs:12,md:6,sm:12,children:(0,R.jsxs)(y.A.Group,{className:"mb-3",children:[(0,R.jsx)(y.A.Label,{className:"mb-4",children:"Select Date Range"}),(0,R.jsx)(te.A,{rangeIndex:this.state.selectedIndex,minDate:this.state.minDate,maxDate:this.state.maxDate,startDate:this.state.startDate,endDate:this.state.endDate,changeDateTimeRange:this.dateTimeRangeChangeHandler,changeDateTimeRangeIndex:this.dateTimeRangeIndexChangeHandler})]})}),(0,R.jsx)(ee.A,{xl:2,xs:12,md:12,sm:12,children:(0,R.jsxs)("div",{className:"d-flex mr-2 mt-5",children:[(0,R.jsx)(B.A,{disabled:this.state.btndisabled,onClick:this.applyFilter,color:"primary",className:"mt-5 mr-3",children:"Apply Filter"}),(0,R.jsx)(D.A,{placement:"bottom",overlay:(0,R.jsx)(w.A,{id:"user-notification-tooltip",children:"Show Today Data"}),children:(0,R.jsx)(B.A,{color:"secondary",className:"mt-5",onClick:this.clearFilter,children:"Reset filter"})})]})})]}),(0,R.jsx)(Q.A,{className:"space",children:(0,R.jsx)("div",{className:"col-xl-12 col-md-12 mb-3",children:(0,R.jsxs)("div",{children:[(0,R.jsxs)("span",{children:[(0,R.jsx)("b",{children:"Note:"})," This dashboard covers"]}),(0,R.jsxs)("span",{children:[" ",(0,R.jsx)("b",{children:this.state.notice?" specific date range data.":"all data. "})]}),(0,R.jsxs)("span",{children:["Apply below filter for further data analytics."," "]})]})})})]})}),(0,R.jsxs)(S(),{tag:"div",blocking:this.state.blocking,color:"#147b82",children:[(0,R.jsx)("div",{className:"row-xl-12 mt-6",children:(0,R.jsx)("div",{className:"card card-custom col-lg-12 col-xl-12 my-widget3",children:(0,R.jsxs)("div",{className:"card-body  p-0 position-relative overflow-hidden",children:[(0,R.jsx)("div",{id:"kt_mixed_widget_1_chart",className:"card-rounded-bottom ",style:{backgroundColor:"white"}}),(0,R.jsx)("div",{className:"card-spacer",children:(0,R.jsxs)("div",{className:" m-0 box-customer-grid",children:[(0,R.jsxs)("div",{className:" bg-primary px-6 py-8 rounded-xl ml-3 mr-3 box-customer-widget",children:[(0,R.jsxs)("div",{className:"d-flex",children:[(0,R.jsx)("span",{className:"svg-icon svg-icon-3x svg-icon-white d-block my-2",children:(0,R.jsx)(v.A,{src:(0,f.oK)("/media/svg/icons/Layout/Layout-4-blocks.svg")})}),(0,R.jsx)(D.A,{placement:"top",overlay:(0,R.jsx)(w.A,{id:"user-notification-tooltip",children:this.state.widget&&this.state.widget[this.state.keys&&this.state.keys[0]]}),children:(0,R.jsx)("div",{className:"text-white font-weight-bold font-size-h2 mt-3 ml-2 wizard-overFlowView cursor-pointer ",children:this.state.widget&&this.state.widget[this.state.keys&&this.state.keys[0]]})})]}),(0,R.jsx)("div",{className:"text-white font-weight-bold font-size-h6 ml-3",children:this.state.widgeTitle&&this.state.widgeTitle[0]})]}),(0,R.jsxs)("div",{className:" bg-primary px-6 py-8 rounded-xl ml-3 mr-3 box-customer-widget",children:[(0,R.jsxs)("div",{className:"d-flex",children:[(0,R.jsx)("span",{className:"svg-icon svg-icon-3x svg-icon-white d-block my-2",children:(0,R.jsx)(v.A,{src:(0,f.oK)("/media/svg/icons/Layout/Layout-4-blocks.svg")})}),(0,R.jsx)(D.A,{placement:"top",overlay:(0,R.jsx)(w.A,{id:"user-notification-tooltip",children:this.state.widget&&this.state.widget[this.state.keys&&this.state.keys[1]]}),children:(0,R.jsx)("div",{className:"text-white font-weight-bold font-size-h2 mt-3 ml-2 wizard-overFlowView cursor-pointer",children:this.state.widget&&this.state.widget[this.state.keys&&this.state.keys[1]]})})]}),(0,R.jsx)("div",{className:"text-white font-weight-bold font-size-h6 ml-3 ",children:this.state.widgeTitle&&this.state.widgeTitle[1]})]}),(0,R.jsxs)("div",{className:" bg-primary px-6 py-8 rounded-xl ml-3 mr-3 box-customer-widget",children:[(0,R.jsxs)("div",{className:"d-flex",children:[(0,R.jsx)("span",{className:"svg-icon svg-icon-3x svg-icon-white d-block my-2",children:(0,R.jsx)(v.A,{src:(0,f.oK)("/media/svg/icons/Layout/Layout-4-blocks.svg")})}),(0,R.jsx)(D.A,{placement:"top",overlay:(0,R.jsx)(w.A,{id:"user-notification-tooltip",children:this.state.widget&&this.state.widget[this.state.keys&&this.state.keys[2]]}),children:(0,R.jsx)("div",{className:"text-white font-weight-bold font-size-h2 ml-2 mt-3 wizard-overFlowView cursor-pointer",children:this.state.widget&&this.state.widget[this.state.keys&&this.state.keys[2]]})})]}),(0,R.jsx)("div",{className:"text-white font-weight-bold font-size-h6 ml-3",children:this.state.widgeTitle&&this.state.widgeTitle[2]})]})]})})]})})}),(0,R.jsxs)("div",{className:"row mt-6",id:"content",children:[(0,R.jsx)("div",{className:"col-xl-6",children:(0,R.jsx)("div",{className:"graph-dashboard-card card p-4 card-custom gutter-b bgi-no-repeat bgi-no-repeat bgi-size-cover",style:{height:"600px"},children:(0,R.jsxs)(ce.A,{sx:{width:"100%",bgcolor:"background.paper",height:"100%",display:"flex",flexDirection:"column"},children:[(0,R.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,R.jsx)("h3",{className:"card-label font-weight-normal text-dark mb-3 mt-2",children:"Result Analysis"}),!0===this.state.showGraph&&(0,R.jsx)("div",{className:"graph-dropdown-div",children:(0,R.jsx)(ue.A,{style:{width:"20vh"},children:(0,R.jsx)(ie,{graphType:this.state.graphType,handleGraphChange:this.handleGraphChange,drilldownFromFun:this.state.drilldownFromFun})})})]}),(0,R.jsx)("hr",{}),this.state.showGraph&&(0,R.jsx)("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:(0,R.jsx)("div",{style:{flex:1},children:(0,R.jsx)(Ae,{displayDataTableFromBar:this.displayDataTableFromBar,parameters:this.state.parameters,startDateEndDateFlag:this.state.startDateEndDateFlag,setXAxisYAxisAfterDrilldown:this.setXAxisYAxisAfterDrilldown,locationId:this.state.selectedLocationValue,cameraId:this.state.selectedCameraValue,selected_model_labels_list:this.state.selectedLabelValue,setFilterParameters:this.setFilterParameters,drillApplied:this.state.drillApplied,title:this.state.title,xAxis:this.state.xAxis,yAxis:this.state.yAxis,graphType:this.state.graphType,dashboardGraphName:this.state.dashboardGraphName})})}),!1===this.state.showGraph&&(0,R.jsx)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,R.jsx)("h4",{children:this.state.graphMessage})})]})})}),(0,R.jsx)("div",{className:"col-xl-6",children:(0,R.jsxs)("div",{className:"graph-dashboard-card card p-4 card-custom gutter-b bgi-no-repeat bgi-no-repeat bgi-size-cover",style:{height:"600px"},children:[(0,R.jsxs)("div",{className:"border-0 d-flex justify-content-between align-items-center ".concat(!this.state.filterEntities.length>0?"mb-3":""),children:[(0,R.jsx)("h3",{className:"card-label font-weight-normal text-dark",children:"Result Table"}),(0,R.jsx)("div",{className:"card-toolbar",children:this.state.filterEntities&&this.state.filterEntities.length>0&&(0,R.jsx)(B.A,{color:"primary",onClick:this.handleSubmit,disabled:this.state.isDownloading,className:"position-relative",children:(0,R.jsxs)("span",{className:"d-flex align-items-center",children:[this.state.isDownloading&&(0,R.jsx)("span",{className:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"}),this.state.isDownloading?"Downloading...":(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("i",{className:"ki ki-download mr-2"}),"Download Excel For Results"]})]})})})]}),(0,R.jsx)("hr",{className:"mt-5"}),(0,R.jsx)(ce.A,{sx:{width:"100%",bgcolor:"background.paper",height:"calc(100% - 80px)",display:"flex",flexDirection:"column"},children:(0,R.jsx)("div",{style:{flex:1},children:(0,R.jsx)(Ce,{listLoading:this.state.listLoading,tableData:this.state.tableData,pageParams:this.state.pageParams,queryParams:this.state.queryParams,filterEntities:this.state.filterEntities,columns:this.state.columns,setQueryParams:this.setQueryParams})})})]})})]}),(0,R.jsx)("div",{children:this.state.showBarTable&&(0,R.jsx)(H,{showBarTable:this.state.showBarTable,cameraData:l,tableData:this.state.tableData,dashboardGraphName:this.state.dashboardGraphName,user:this.props.user})})]})]})}}])}(s.Component);var Ve=(0,_.Ng)(function(e){return{user:e.auth.user,location:e.location}},j.o1)((0,Y.A)(function(e){return{root:{width:"54px",height:"24px",padding:"0px"},switchBase:{color:"#818181",padding:"1px","&$checked":{"& + $track":{backgroundColor:"#147b82"}}},thumb:{color:"white",width:"25px",height:"22px",margin:"0px"},track:{borderRadius:"20px",backgroundColor:"#147b82",opacity:"1 !important","&:after, &:before":{color:"white",fontSize:"8px",fontWeight:"10px",position:"absolute",top:"7px"},"&:after":{content:"'LABEL'",left:"5px"},"&:before":{content:"'EVENT'",right:"2px"}},checked:{color:"#23bf58 !important",transform:"translateX(26px) !important"}}})(Pe));var Oe=function(){var e=(0,l.SL)(),t=(0,s.useMemo)(function(){return{demo:n().get(e.config,"demo")}},[e]);if(!(0,_.d4)(function(e){return{user:e.auth.user}},_.bN).user)return(0,R.jsx)("div",{children:"Loading..."});try{return(0,R.jsx)(R.Fragment,{children:"demo1"===t.demo&&(0,R.jsx)(Ve,{})})}catch(a){return console.error("Error rendering dashboard:",a),(0,R.jsx)("div",{children:"Something went wrong."})}};function ze(){return(0,R.jsx)(Oe,{})}}}]);
//# sourceMappingURL=258.8e0107f1.chunk.js.map